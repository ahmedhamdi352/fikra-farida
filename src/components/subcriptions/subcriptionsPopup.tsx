'use client';

import LoadingSpinner from 'components/ui/LoadingSpinner';
import { useAuth } from 'context/AuthContext';
import Link from 'next/link';
import { useState, useRef, useEffect } from 'react';
import { createPortal } from 'react-dom';
import { useRouter } from 'next/navigation';
import Cookies from 'js-cookie';

interface SubscriptionsPopupProps {
  isOpen: boolean;
  onClose: () => void;
}

export default function SubscriptionsPopup({ isOpen, onClose }: SubscriptionsPopupProps) {
  const [activeTab, setActiveTab] = useState<'yearly' | 'monthly'>('yearly');
  const [mounted, setMounted] = useState(false);
  const [isLoadingOnline, setIsLoadingOnline] = useState(false);
  const modalRef = useRef<HTMLDivElement>(null);
  const router = useRouter();
  const { activeProfile } = useAuth();


  const features = [
    {
      name: 'All basic plan feature',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M15.1994 9.94404C14.7659 9.53341 14.487 8.98609 14.4094 8.39404L14.0064 5.31104L11.2754 6.79704C10.7507 7.08248 10.1437 7.17853 9.55642 7.06904L6.50042 6.50004L7.07042 9.55604C7.17985 10.1437 7.08344 10.7511 6.79742 11.276L5.31142 14.006L8.39442 14.409C8.98647 14.4866 9.5338 14.7655 9.94442 15.199L12.0824 17.456L13.4184 14.649C13.6749 14.1096 14.1092 13.6749 14.6484 13.418L17.4564 12.082L15.1994 9.94404ZM15.2244 15.508L13.0114 20.158C12.9696 20.246 12.9069 20.3224 12.8289 20.3807C12.7509 20.439 12.6599 20.4774 12.5637 20.4927C12.4675 20.5079 12.3691 20.4995 12.2769 20.4683C12.1847 20.437 12.1014 20.3837 12.0344 20.313L8.49242 16.574C8.39753 16.474 8.27112 16.4098 8.13442 16.392L3.02842 15.724C2.93184 15.7115 2.83978 15.6756 2.76018 15.6195C2.68058 15.5634 2.61583 15.4887 2.57153 15.402C2.52723 15.3153 2.5047 15.219 2.5059 15.1217C2.50711 15.0243 2.53199 14.9286 2.57842 14.843L5.04042 10.319C5.10621 10.1982 5.12845 10.0584 5.10342 9.92304L4.16042 4.86004C4.14251 4.7642 4.14823 4.66545 4.17707 4.57232C4.20591 4.4792 4.25701 4.3945 4.32595 4.32556C4.39488 4.25663 4.47958 4.20553 4.57271 4.17669C4.66583 4.14784 4.76459 4.14213 4.86042 4.16004L9.92242 5.10304C10.0581 5.12831 10.1983 5.10606 10.3194 5.04004L14.8424 2.58004C14.9279 2.53342 15.0235 2.50832 15.1209 2.5069C15.2182 2.50548 15.3145 2.52779 15.4013 2.57189C15.4882 2.61599 15.563 2.68057 15.6192 2.76004C15.6755 2.83951 15.7116 2.93149 15.7244 3.02804L16.3924 8.13504C16.4104 8.27138 16.4746 8.39741 16.5744 8.49204L20.3134 12.034C20.3841 12.1011 20.4373 12.1843 20.4686 12.2765C20.4999 12.3687 20.5083 12.4672 20.4931 12.5633C20.4778 12.6595 20.4394 12.7505 20.3811 12.8285C20.3228 12.9065 20.2463 12.9692 20.1584 13.011L15.5084 15.224C15.3839 15.2833 15.2836 15.3836 15.2244 15.508ZM16.0214 17.435L17.4354 16.021L21.6784 20.263L20.2634 21.678L16.0214 17.435Z" fill="white" />
      </svg>,
    },
    {
      name: 'offline sharing mode',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M9.77594 18.4065L11.6569 16.5255C11.7689 16.5085 11.8834 16.5 12.0004 16.5C12.4601 16.5001 12.9087 16.6411 13.2858 16.9039C13.663 17.1667 13.9506 17.5387 14.11 17.9698C14.2694 18.401 14.2929 18.8706 14.1773 19.3155C14.0618 19.7604 13.8128 20.1593 13.4637 20.4584C13.1147 20.7575 12.6825 20.9426 12.2251 20.9886C11.7678 21.0347 11.3073 20.9396 10.9056 20.7161C10.5039 20.4926 10.1803 20.1515 9.97837 19.7385C9.77641 19.3256 9.70576 18.8607 9.77594 18.4065ZM14.1934 13.9905L15.3034 12.8805C15.8449 13.1925 16.3444 13.581 16.7839 14.0385C16.9218 14.1819 16.997 14.3742 16.9931 14.5731C16.9891 14.772 16.9064 14.9611 16.7629 15.099C16.6195 15.2368 16.4272 15.312 16.2283 15.3081C16.0295 15.3042 15.8403 15.2214 15.7024 15.078C15.2704 14.626 14.7588 14.2574 14.1934 13.9905ZM17.4364 10.746L18.5104 9.67347C18.9734 10.0225 19.4084 10.4085 19.8154 10.8315C19.8836 10.9026 19.9371 10.9864 19.9728 11.0782C20.0086 11.17 20.0259 11.2679 20.0238 11.3664C20.0217 11.4649 20.0003 11.562 19.9607 11.6521C19.921 11.7423 19.864 11.8238 19.7929 11.892C19.7218 11.9601 19.638 12.0136 19.5462 12.0494C19.4544 12.0851 19.3565 12.1024 19.258 12.1004C19.1595 12.0983 19.0624 12.0768 18.9723 12.0372C18.8821 11.9976 18.8006 11.9406 18.7324 11.8695C18.3354 11.4565 17.9016 11.0804 17.4364 10.746ZM10.5919 9.10497C8.58109 9.41052 6.72586 10.3669 5.31044 11.8275C5.17128 11.9678 4.98238 12.0475 4.78479 12.0493C4.58719 12.0511 4.39688 11.9748 4.25519 11.8371C4.1135 11.6993 4.0319 11.5112 4.0281 11.3137C4.02431 11.1161 4.09864 10.925 4.23494 10.782C5.26629 9.71814 6.50552 8.87791 7.87552 8.31354C9.24553 7.74918 10.717 7.47276 12.1984 7.50147L10.5919 9.10497ZM20.5999 7.58397L21.6649 6.51897C22.0759 6.86497 22.4689 7.23297 22.8439 7.62297C22.9733 7.76786 23.0414 7.95728 23.0339 8.15138C23.0265 8.34548 22.944 8.5291 22.8038 8.6636C22.6637 8.7981 22.4768 8.87299 22.2826 8.8725C22.0884 8.87201 21.9019 8.79618 21.7624 8.66097C21.3964 8.27952 21.0082 7.9199 20.5999 7.58397ZM14.8894 4.80897C13.9404 4.60234 12.9717 4.49874 12.0004 4.49997C10.1907 4.49825 8.39912 4.86041 6.73216 5.56492C5.0652 6.26943 3.5569 7.30191 2.29694 8.60097C2.22856 8.67274 2.14664 8.73025 2.0559 8.77017C1.96516 8.81008 1.86741 8.83161 1.7683 8.83351C1.66919 8.83542 1.57069 8.81765 1.47848 8.78125C1.38628 8.74485 1.30221 8.69053 1.23113 8.62143C1.16005 8.55233 1.10337 8.46983 1.06438 8.3787C1.02538 8.28756 1.00484 8.1896 1.00394 8.09047C1.00304 7.99135 1.02179 7.89303 1.05913 7.8012C1.09646 7.70937 1.15163 7.62585 1.22144 7.55547C2.62119 6.1126 4.29668 4.9658 6.14837 4.18323C8.00006 3.40065 9.99017 2.99826 12.0004 2.99997C13.4164 2.99997 14.8024 3.19647 16.1254 3.57297L14.8894 4.80897ZM12.0004 19.5C12.1993 19.5 12.3901 19.421 12.5308 19.2803C12.6714 19.1396 12.7504 18.9489 12.7504 18.75C12.7504 18.5511 12.6714 18.3603 12.5308 18.2196C12.3901 18.079 12.1993 18 12.0004 18C11.8015 18 11.6108 18.079 11.4701 18.2196C11.3295 18.3603 11.2504 18.5511 11.2504 18.75C11.2504 18.9489 11.3295 19.1396 11.4701 19.2803C11.6108 19.421 11.8015 19.5 12.0004 19.5ZM3.86444 21C3.72298 21.1366 3.53353 21.2122 3.33689 21.2105C3.14024 21.2088 2.95213 21.1299 2.81307 20.9908C2.67402 20.8518 2.59514 20.6637 2.59343 20.467C2.59172 20.2704 2.66732 20.0809 2.80394 19.9395L21.2194 1.71897C21.3603 1.57814 21.5513 1.49902 21.7504 1.49902C21.9496 1.49902 22.1406 1.57814 22.2814 1.71897C22.4223 1.8598 22.5014 2.05081 22.5014 2.24997C22.5014 2.44913 22.4223 2.64014 22.2814 2.78097L3.86444 21Z" fill="white" />
      </svg>,
    },
    {
      name: 'add up to 3  business profiles',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <g clip-path="url(#clip0_2408_7727)">
          <path d="M21.6797 8.0625C22.0312 8.25781 22.3516 8.49609 22.6406 8.77734C22.9297 9.05859 23.1719 9.37109 23.3672 9.71484C23.5625 10.0586 23.7188 10.4219 23.8359 10.8047C23.9531 11.1875 24.0078 11.5859 24 12H22.5C22.5 11.5938 22.4219 11.207 22.2656 10.8398C22.1094 10.4727 21.8945 10.1562 21.6211 9.89062C21.3477 9.625 21.0273 9.41016 20.6602 9.24609C20.293 9.08203 19.9062 9 19.5 9C19.0859 9 18.6992 9.07812 18.3398 9.23438C17.9805 9.39062 17.6641 9.60547 17.3906 9.87891C17.1172 10.1523 16.9023 10.4727 16.7461 10.8398C16.5898 11.207 16.5078 11.5938 16.5 12C16.5 12.7109 16.3398 13.3867 16.0195 14.0273C15.6992 14.668 15.25 15.1992 14.6719 15.6211C15.1797 15.8789 15.6367 16.1953 16.043 16.5703C16.4492 16.9453 16.8008 17.3672 17.0977 17.8359C17.3945 18.3047 17.6172 18.8047 17.7656 19.3359C17.9141 19.8672 17.9922 20.4219 18 21H16.5C16.5 20.3828 16.3828 19.8008 16.1484 19.2539C15.9141 18.707 15.5898 18.2305 15.1758 17.8242C14.7617 17.418 14.2852 17.0977 13.7461 16.8633C13.207 16.6289 12.625 16.5078 12 16.5C11.3828 16.5 10.8008 16.6172 10.2539 16.8516C9.70703 17.0859 9.23047 17.4102 8.82422 17.8242C8.41797 18.2383 8.09766 18.7148 7.86328 19.2539C7.62891 19.793 7.50781 20.375 7.5 21H6C6 20.4297 6.07812 19.8789 6.23438 19.3477C6.39062 18.8164 6.61328 18.3164 6.90234 17.8477C7.19141 17.3789 7.53906 16.957 7.94531 16.582C8.35156 16.207 8.8125 15.8867 9.32812 15.6211C8.75781 15.1992 8.3125 14.668 7.99219 14.0273C7.67188 13.3867 7.50781 12.7109 7.5 12C7.5 11.5938 7.42188 11.207 7.26562 10.8398C7.10938 10.4727 6.89453 10.1562 6.62109 9.89062C6.34766 9.625 6.02734 9.41016 5.66016 9.24609C5.29297 9.08203 4.90625 9 4.5 9C4.08594 9 3.69922 9.07812 3.33984 9.23438C2.98047 9.39062 2.66406 9.60547 2.39062 9.87891C2.11719 10.1523 1.90234 10.4727 1.74609 10.8398C1.58984 11.207 1.50781 11.5938 1.5 12H0C0 11.5938 0.0546875 11.1992 0.164062 10.8164C0.273438 10.4336 0.425781 10.0703 0.621094 9.72656C0.816406 9.38281 1.0625 9.07031 1.35938 8.78906C1.65625 8.50781 1.97656 8.26562 2.32031 8.0625C2.0625 7.78906 1.86328 7.47266 1.72266 7.11328C1.58203 6.75391 1.50781 6.38281 1.5 6C1.5 5.59375 1.57812 5.20703 1.73438 4.83984C1.89062 4.47266 2.10547 4.15625 2.37891 3.89062C2.65234 3.625 2.96875 3.41016 3.32812 3.24609C3.6875 3.08203 4.07812 3 4.5 3C4.90625 3 5.29297 3.07812 5.66016 3.23438C6.02734 3.39062 6.34375 3.60547 6.60938 3.87891C6.875 4.15234 7.08984 4.47266 7.25391 4.83984C7.41797 5.20703 7.5 5.59375 7.5 6C7.5 6.38281 7.42969 6.75391 7.28906 7.11328C7.14844 7.47266 6.94531 7.78906 6.67969 8.0625C7.32031 8.41406 7.84375 8.89844 8.25 9.51562C8.67188 8.89062 9.21094 8.39844 9.86719 8.03906C10.5234 7.67969 11.2344 7.5 12 7.5C12.7578 7.5 13.4648 7.67969 14.1211 8.03906C14.7773 8.39844 15.3203 8.89062 15.75 9.51562C16.1562 8.89844 16.6797 8.41406 17.3203 8.0625C17.0625 7.78906 16.8633 7.47266 16.7227 7.11328C16.582 6.75391 16.5078 6.38281 16.5 6C16.5 5.59375 16.5781 5.20703 16.7344 4.83984C16.8906 4.47266 17.1055 4.15625 17.3789 3.89062C17.6523 3.625 17.9688 3.41016 18.3281 3.24609C18.6875 3.08203 19.0781 3 19.5 3C19.9062 3 20.293 3.07812 20.6602 3.23438C21.0273 3.39062 21.3438 3.60547 21.6094 3.87891C21.875 4.15234 22.0898 4.47266 22.2539 4.83984C22.418 5.20703 22.5 5.59375 22.5 6C22.5 6.38281 22.4297 6.75391 22.2891 7.11328C22.1484 7.47266 21.9453 7.78906 21.6797 8.0625ZM3 6C3 6.21094 3.03906 6.40625 3.11719 6.58594C3.19531 6.76562 3.30078 6.92188 3.43359 7.05469C3.56641 7.1875 3.72656 7.29688 3.91406 7.38281C4.10156 7.46875 4.29688 7.50781 4.5 7.5C4.71094 7.5 4.90625 7.46094 5.08594 7.38281C5.26562 7.30469 5.42188 7.19922 5.55469 7.06641C5.6875 6.93359 5.79688 6.77344 5.88281 6.58594C5.96875 6.39844 6.00781 6.20312 6 6C6 5.78906 5.96094 5.59375 5.88281 5.41406C5.80469 5.23438 5.69922 5.07812 5.56641 4.94531C5.43359 4.8125 5.27344 4.70312 5.08594 4.61719C4.89844 4.53125 4.70312 4.49219 4.5 4.5C4.28906 4.5 4.09375 4.53906 3.91406 4.61719C3.73438 4.69531 3.57812 4.80078 3.44531 4.93359C3.3125 5.06641 3.20312 5.22656 3.11719 5.41406C3.03125 5.60156 2.99219 5.79688 3 6ZM12 15C12.4062 15 12.793 14.9219 13.1602 14.7656C13.5273 14.6094 13.8438 14.3945 14.1094 14.1211C14.375 13.8477 14.5898 13.5312 14.7539 13.1719C14.918 12.8125 15 12.4219 15 12C15 11.5938 14.9219 11.207 14.7656 10.8398C14.6094 10.4727 14.3945 10.1562 14.1211 9.89062C13.8477 9.625 13.5273 9.41016 13.1602 9.24609C12.793 9.08203 12.4062 9 12 9C11.5859 9 11.1992 9.07812 10.8398 9.23438C10.4805 9.39062 10.1641 9.60547 9.89062 9.87891C9.61719 10.1523 9.40234 10.4727 9.24609 10.8398C9.08984 11.207 9.00781 11.5938 9 12C9 12.4141 9.07812 12.8008 9.23438 13.1602C9.39062 13.5195 9.60547 13.8359 9.87891 14.1094C10.1523 14.3828 10.4688 14.5977 10.8281 14.7539C11.1875 14.9102 11.5781 14.9922 12 15ZM18 6C18 6.21094 18.0391 6.40625 18.1172 6.58594C18.1953 6.76562 18.3008 6.92188 18.4336 7.05469C18.5664 7.1875 18.7266 7.29688 18.9141 7.38281C19.1016 7.46875 19.2969 7.50781 19.5 7.5C19.7109 7.5 19.9062 7.46094 20.0859 7.38281C20.2656 7.30469 20.4219 7.19922 20.5547 7.06641C20.6875 6.93359 20.7969 6.77344 20.8828 6.58594C20.9688 6.39844 21.0078 6.20312 21 6C21 5.78906 20.9609 5.59375 20.8828 5.41406C20.8047 5.23438 20.6992 5.07812 20.5664 4.94531C20.4336 4.8125 20.2734 4.70312 20.0859 4.61719C19.8984 4.53125 19.7031 4.49219 19.5 4.5C19.2891 4.5 19.0938 4.53906 18.9141 4.61719C18.7344 4.69531 18.5781 4.80078 18.4453 4.93359C18.3125 5.06641 18.2031 5.22656 18.1172 5.41406C18.0312 5.60156 17.9922 5.79688 18 6Z" fill="white" />
        </g>
        <defs>
          <clipPath id="clip0_2408_7727">
            <rect width="24" height="24" fill="white" />
          </clipPath>
        </defs>
      </svg>,
    },
    {
      name: 'color customization',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M8.87988 21.2496H18.7499C19.4129 21.2496 20.0488 20.9862 20.5176 20.5174C20.9865 20.0486 21.2499 19.4127 21.2499 18.7496V15.1196C21.2446 14.4601 20.9789 13.8293 20.5106 13.3648C20.0423 12.9003 19.4095 12.6396 18.7499 12.6396H17.4799M11.3799 18.7296L17.4799 12.6196L19.3499 10.7496C19.5824 10.5183 19.7669 10.2432 19.8928 9.94033C20.0187 9.63744 20.0835 9.31265 20.0835 8.98463C20.0835 8.65662 20.0187 8.33183 19.8928 8.02894C19.7669 7.72604 19.5824 7.45101 19.3499 7.21963L16.7799 4.64963C16.5485 4.41712 16.2735 4.23262 15.9706 4.10672C15.6677 3.98083 15.3429 3.91602 15.0149 3.91602C14.6869 3.91602 14.3621 3.98083 14.0592 4.10672C13.7563 4.23262 13.4813 4.41712 13.2499 4.64963L11.3799 6.51963" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M8.88 2.75H5.25C4.58696 2.75 3.95107 3.01339 3.48223 3.48223C3.01339 3.95107 2.75 4.58696 2.75 5.25V18.75C2.75 19.413 3.01339 20.0489 3.48223 20.5178C3.95107 20.9866 4.58696 21.25 5.25 21.25H8.88C9.54304 21.25 10.1789 20.9866 10.6478 20.5178C11.1166 20.0489 11.38 19.413 11.38 18.75V5.25C11.38 4.58696 11.1166 3.95107 10.6478 3.48223C10.1789 3.01339 9.54304 2.75 8.88 2.75Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M7.0647 18.5942C7.27403 18.5942 7.48131 18.553 7.6747 18.4729C7.86809 18.3928 8.04381 18.2754 8.19183 18.1274C8.33985 17.9794 8.45726 17.8036 8.53737 17.6102C8.61747 17.4169 8.6587 17.2096 8.6587 17.0002C8.6587 16.7909 8.61747 16.5836 8.53737 16.3903C8.45726 16.1969 8.33985 16.0211 8.19183 15.8731C8.04381 15.7251 7.86809 15.6077 7.6747 15.5276C7.48131 15.4475 7.27403 15.4062 7.0647 15.4063C6.64195 15.4063 6.23651 15.5742 5.93757 15.8731C5.63864 16.1721 5.4707 16.5775 5.4707 17.0002C5.4707 17.423 5.63864 17.8284 5.93757 18.1274C6.23651 18.4263 6.64195 18.5942 7.0647 18.5942Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>,
    },
    {
      name: 'up to 3 custom display styles',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M20 11.5V7L15.5 2H5C4.73478 2 4.48043 2.10536 4.29289 2.29289C4.10536 2.48043 4 2.73478 4 3V21C4 21.2652 4.10536 21.5196 4.29289 21.7071C4.48043 21.8946 4.73478 22 5 22H11" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M16.5 20.5C18.985 20.5 21 17.5 21 17.5C21 17.5 18.985 14.5 16.5 14.5C14.015 14.5 12 17.5 12 17.5C12 17.5 14.015 20.5 16.5 20.5Z" stroke="white" stroke-linejoin="round" />
        <path d="M16.5 18.5C16.7652 18.5 17.0196 18.3946 17.2071 18.2071C17.3946 18.0196 17.5 17.7652 17.5 17.5C17.5 17.2348 17.3946 16.9804 17.2071 16.7929C17.0196 16.6054 16.7652 16.5 16.5 16.5C16.2348 16.5 15.9804 16.6054 15.7929 16.7929C15.6054 16.9804 15.5 17.2348 15.5 17.5C15.5 17.7652 15.6054 18.0196 15.7929 18.2071C15.9804 18.3946 16.2348 18.5 16.5 18.5Z" fill="white" />
        <path d="M15 2V7H20" stroke="white" stroke-linecap="round" stroke-linejoin="round" />
      </svg>
    },
    {
      name: 'verified  account',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <g clip-path="url(#clip0_2409_7840)">
          <path d="M17.0298 9.77985C17.1623 9.63767 17.2344 9.44963 17.231 9.25532C17.2276 9.06102 17.1489 8.87564 17.0115 8.73823C16.8741 8.60081 16.6887 8.5221 16.4944 8.51867C16.3001 8.51524 16.112 8.58737 15.9698 8.71985L10.4998 14.1898L8.02985 11.7198C7.88767 11.5874 7.69963 11.5152 7.50532 11.5187C7.31102 11.5221 7.12564 11.6008 6.98822 11.7382C6.85081 11.8756 6.7721 12.061 6.76867 12.2553C6.76524 12.4496 6.83737 12.6377 6.96985 12.7798L9.96985 15.7798C10.1105 15.9203 10.3011 15.9992 10.4998 15.9992C10.6986 15.9992 10.8892 15.9203 11.0298 15.7798L17.0298 9.77985Z" fill="white" />
          <path d="M14.1357 1.19974L15.5107 2.20974C15.7847 2.41074 16.1037 2.54274 16.4397 2.59374L18.1267 2.85274C18.8861 2.96943 19.5884 3.32531 20.1315 3.86863C20.6747 4.41195 21.0303 5.11437 21.1467 5.87374L21.4057 7.55974C21.4567 7.89574 21.5887 8.21474 21.7897 8.48874L22.7997 9.86374C23.2544 10.4831 23.4995 11.2314 23.4995 11.9997C23.4995 12.7681 23.2544 13.5163 22.7997 14.1357L21.7897 15.5107C21.5884 15.7848 21.4566 16.1036 21.4057 16.4397L21.1467 18.1267C21.0301 18.8861 20.6742 19.5884 20.1309 20.1315C19.5875 20.6747 18.8851 21.0303 18.1257 21.1467L16.4397 21.4057C16.1036 21.4566 15.7848 21.5884 15.5107 21.7897L14.1357 22.7997C13.5163 23.2544 12.7681 23.4995 11.9997 23.4995C11.2314 23.4995 10.4831 23.2544 9.86374 22.7997L8.48874 21.7897C8.21473 21.5884 7.89593 21.4566 7.55974 21.4057L5.87274 21.1467C5.11341 21.0301 4.4111 20.6742 3.86796 20.1309C3.32482 19.5875 2.96917 18.8851 2.85274 18.1257L2.59374 16.4397C2.54284 16.1036 2.41106 15.7848 2.20974 15.5107L1.19974 14.1357C0.745133 13.5163 0.5 12.7681 0.5 11.9997C0.5 11.2314 0.745133 10.4831 1.19974 9.86374L2.20974 8.48874C2.41074 8.21474 2.54274 7.89574 2.59374 7.55974L2.85274 5.87274C2.96943 5.11341 3.32531 4.4111 3.86863 3.86796C4.41195 3.32482 5.11437 2.96917 5.87374 2.85274L7.55974 2.59374C7.89574 2.54274 8.21474 2.41074 8.48874 2.20974L9.86374 1.19974C10.4831 0.745133 11.2314 0.5 11.9997 0.5C12.7681 0.5 13.5163 0.745133 14.1357 1.19974ZM10.7517 2.40874L9.37674 3.41874C8.90772 3.76338 8.36214 3.98916 7.78674 4.07674L6.10074 4.33474C5.65673 4.40279 5.24602 4.61076 4.92839 4.92839C4.61076 5.24602 4.40279 5.65673 4.33474 6.10074L4.07674 7.78674C3.98901 8.36179 3.76323 8.90702 3.41874 9.37574L2.40874 10.7517C2.14324 11.1137 2.00009 11.5509 2.00009 11.9997C2.00009 12.4486 2.14324 12.8858 2.40874 13.2477L3.41874 14.6227C3.76274 15.0917 3.98874 15.6377 4.07674 16.2127L4.33474 17.8987C4.47474 18.8097 5.18974 19.5247 6.10074 19.6647L7.78674 19.9227C8.36179 20.0105 8.90702 20.2363 9.37574 20.5807L10.7517 21.5907C11.1137 21.8562 11.5509 21.9994 11.9997 21.9994C12.4486 21.9994 12.8858 21.8562 13.2477 21.5907L14.6227 20.5807C15.0919 20.2365 15.6374 20.011 16.2127 19.9237L17.8987 19.6637C18.3426 19.5957 18.7532 19.3879 19.0708 19.0705C19.3884 18.7531 19.5965 18.3426 19.6647 17.8987L19.9227 16.2127C20.0105 15.6377 20.2363 15.0925 20.5807 14.6237L21.5907 13.2477C21.8562 12.8858 21.9994 12.4486 21.9994 11.9997C21.9994 11.5509 21.8562 11.1137 21.5907 10.7517L20.5807 9.37674C20.2365 8.90763 20.011 8.36205 19.9237 7.78674L19.6637 6.10074C19.5957 5.65687 19.3879 5.24627 19.0705 4.92866C18.7531 4.61105 18.3426 4.40299 17.8987 4.33474L16.2127 4.07674C15.6377 3.98901 15.0925 3.76323 14.6237 3.41874L13.2477 2.40874C12.8858 2.14324 12.4486 2.00009 11.9997 2.00009C11.5509 2.00009 11.1137 2.14324 10.7517 2.40874Z" fill="white" />
        </g>
        <defs>
          <clipPath id="clip0_2409_7840">
            <rect width="24" height="24" fill="white" />
          </clipPath>
        </defs>
      </svg>,
    },
    {
      name: 'export & mange contacts',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M4 10C4 6.229 4 4.343 5.172 3.172C6.344 2.001 8.229 2 12 2H13.5C17.271 2 19.157 2 20.328 3.172C21.499 4.344 21.5 6.229 21.5 10V14C21.5 17.771 21.5 19.657 20.328 20.828C19.156 21.999 17.271 22 13.5 22H12C8.229 22 6.343 22 5.172 20.828C4.001 19.656 4 17.771 4 14V10Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M9.8 11.974C9.373 11.23 9.167 10.623 9.043 10.007C8.859 9.097 9.28 8.207 9.976 7.639C10.271 7.399 10.608 7.481 10.782 7.794L11.175 8.499C11.486 9.057 11.642 9.337 11.611 9.633C11.581 9.929 11.371 10.17 10.951 10.653L9.8 11.974ZM9.8 11.974C10.7001 13.5164 11.9836 14.7999 13.526 15.7M13.526 15.7C14.27 16.127 14.877 16.333 15.493 16.457C16.403 16.641 17.293 16.22 17.861 15.524C18.101 15.229 18.019 14.892 17.706 14.718L17.002 14.325C16.442 14.014 16.163 13.858 15.867 13.889C15.571 13.919 15.33 14.129 14.847 14.549L13.526 15.7ZM5 6H2.5M5 12H2.5M5 18H2.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>,
    },
    {
      name: 'performance tracking, analytics &cliks',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M4.93001 4.92969C4.00002 5.85707 3.26244 6.95906 2.75962 8.17236C2.2568 9.38565 1.99865 10.6863 2.00001 11.9997C2.00001 14.7597 3.12001 17.2597 4.93001 19.0697L6.34001 17.6597C5.59466 16.9182 5.004 16.036 4.6023 15.0644C4.20061 14.0928 3.99588 13.0511 4.00001 11.9997C4.00001 9.78969 4.89001 7.77969 6.34001 6.33969L4.93001 4.92969ZM19.07 4.92969L17.66 6.33969C18.4045 7.08187 18.9945 7.96416 19.3962 8.93562C19.7978 9.90709 20.003 10.9485 20 11.9997C20 14.2197 19.11 16.2197 17.66 17.6597L19.07 19.0697C20 18.1423 20.7376 17.0403 21.2404 15.827C21.7432 14.6137 22.0014 13.313 22 11.9997C22 9.23969 20.88 6.73969 19.07 4.92969ZM7.76001 7.75969C7.20181 8.31565 6.75896 8.97643 6.45693 9.70407C6.15489 10.4317 5.99961 11.2119 6.00001 11.9997C6.00001 13.6497 6.67001 15.1497 7.76001 16.2397L9.17001 14.8297C8.79867 14.4579 8.50421 14.0167 8.30346 13.5311C8.10271 13.0455 7.99959 12.5251 8.00001 11.9997C8.00001 10.8897 8.45001 9.88969 9.17001 9.16969L7.76001 7.75969ZM16.24 7.75969L14.83 9.16969C15.2013 9.54144 15.4958 9.98271 15.6966 10.4683C15.8973 10.9539 16.0004 11.4742 16 11.9997C16 13.1097 15.55 14.1097 14.83 14.8297L16.24 16.2397C16.7982 15.6837 17.241 15.0229 17.5431 14.2953C17.8451 13.5677 18.0004 12.7875 18 11.9997C18 10.3497 17.33 8.84969 16.24 7.75969ZM12 9.99969C11.4696 9.99969 10.9609 10.2104 10.5858 10.5855C10.2107 10.9605 10 11.4693 10 11.9997C10 12.5301 10.2107 13.0388 10.5858 13.4139C10.9609 13.789 11.4696 13.9997 12 13.9997C12.5304 13.9997 13.0391 13.789 13.4142 13.4139C13.7893 13.0388 14 12.5301 14 11.9997C14 11.4693 13.7893 10.9605 13.4142 10.5855C13.0391 10.2104 12.5304 9.99969 12 9.99969Z" fill="white" />
      </svg>,
    },
    {
      name: 'access to the full business',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M7 18V16M12 18V15M17 18V13M2.5 12C2.5 7.522 2.5 5.282 3.891 3.891C5.282 2.5 7.521 2.5 12 2.5C16.478 2.5 18.718 2.5 20.109 3.891C21.5 5.282 21.5 7.521 21.5 12C21.5 16.478 21.5 18.718 20.109 20.109C18.718 21.5 16.479 21.5 12 21.5C7.522 21.5 5.282 21.5 3.891 20.109C2.5 18.718 2.5 16.479 2.5 12Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M5.99219 11.4865C8.14719 11.5585 13.0342 11.2335 15.8142 6.82146M13.9922 6.28846L15.8682 5.98646C16.0962 5.95746 16.4322 6.13846 16.5152 6.35346L17.0102 7.99146" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>,
    },
    {
      name: 'unlimited pro links',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M12 12C12 12 10.357 15 8.7 15C7.043 15 6 13.657 6 12C6 10.343 7.043 9 8.7 9C10.357 9 12 12 12 12ZM12 12C12 12 13.643 15 15.3 15C16.957 15 18 13.657 18 12C18 10.343 16.957 9 15.3 9C13.643 9 12 12 12 12Z" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M17.725 2.5C19.115 2.654 20.05 3.001 20.748 3.787C22 5.197 22 7.464 22 12C22 16.536 22 18.804 20.748 20.213C20.05 20.999 19.114 21.346 17.725 21.5M6.275 21.5C4.885 21.346 3.95 20.999 3.252 20.213C2 18.803 2 16.536 2 12C2 7.464 2 5.196 3.252 3.787C3.95 3.001 4.886 2.654 6.275 2.5" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>,
    },
    {
      name: 'exclusive links types',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M10.5215 13.4796C11.2889 14.2461 12.3288 14.6772 13.4135 14.6786C13.7718 14.674 14.1285 14.6283 14.4765 14.5426C15.1665 14.35 15.7958 13.9841 16.3045 13.4796L17.2735 12.5116L20.1515 9.62362C20.6912 9.04578 21.0517 8.32372 21.1891 7.54504C21.3265 6.76637 21.235 5.96454 20.9256 5.23687C20.6163 4.50919 20.1023 3.88693 19.4463 3.44561C18.7902 3.00428 18.0201 2.76285 17.2295 2.75062C16.1697 2.73226 15.1439 3.12506 14.3675 3.84662L11.4895 6.73562" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M12.4445 17.3352L9.55255 20.2232C8.96973 20.7376 8.25254 21.0754 7.48482 21.1971C6.71711 21.3188 5.9306 21.2195 5.21726 20.9107C4.50391 20.6019 3.89322 20.0964 3.45658 19.4534C3.01994 18.8103 2.7754 18.0562 2.75155 17.2792C2.72295 16.2382 3.09156 15.2254 3.78255 14.4462L6.67455 11.5582L7.64355 10.5902C8.15191 10.0868 8.78045 9.72161 9.46955 9.52925C10.1642 9.34388 10.8953 9.34443 11.5897 9.53083C12.284 9.71723 12.9171 10.0829 13.4255 10.5912" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>,
    },
    {
      name: 'unlimited pro home screen wedget tool',
      icon: <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
        <path d="M7.0688 5C7.2048 4.131 7.4618 3.509 7.9478 3.025C8.9788 2 10.6378 2 13.9578 2C17.2778 2 18.9368 2 19.9678 3.025C20.9988 4.05 20.9988 5.7 20.9988 9V15C20.9988 18.3 20.9988 19.95 19.9678 20.975C18.9368 22 17.2778 22 13.9578 22C10.6378 22 8.9788 22 7.9478 20.975C7.2928 20.323 7.0538 19.419 6.9668 18M13.9998 19H14.0088" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
        <path d="M6.44302 7.95215H9.92302C10.359 7.96715 11.018 8.49815 11.018 8.90915V12.5141M2.99902 15.9521L10.267 8.74915" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
      </svg>,
    },
  ];

  useEffect(() => {
    setMounted(true);
    return () => setMounted(false);
  }, []);

  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (modalRef.current && !modalRef.current.contains(event.target as Node)) {
        onClose();
      }
    }

    if (mounted && isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
      return () => {
        document.removeEventListener('mousedown', handleClickOutside);
      };
    }
  }, [mounted, isOpen, onClose]);


  const handlePay = async () => {
    try {
      // Get token from cookies to ensure it's available for webhook
      const tokenFromCookies = Cookies.get('token');
      const userToken = tokenFromCookies || activeProfile?.token;
      
      console.log('üîç Frontend Debug:');
      console.log('tokenFromCookies:', tokenFromCookies ? 'TOKEN_FOUND' : 'NO_COOKIE_TOKEN');
      console.log('activeProfile?.token:', activeProfile?.token ? 'PROFILE_TOKEN_FOUND' : 'NO_PROFILE_TOKEN');
      console.log('Final userToken (orderId):', userToken ? 'TOKEN_READY' : 'NO_TOKEN');

      const payloadData = {
        amount: activeTab === 'yearly' ? 449 : 50,
        currency: 'EGP',
        orderId: userToken,
        email: activeProfile?.email || 'contact@fikrafarida.com',
        firstName: activeProfile?.fullname || 'guest',
      };
      const response = await fetch('/api/kashier/subscription', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(payloadData),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.error || 'paymentFailed');
      }

      const result = await response.json();

      if (result.redirectUrl) {
        // Redirect to Kashier's payment page
        window.location.href = result.redirectUrl;
      } else if (result.error) {
        throw new Error(result.error);
      } else {
        throw new Error('Invalid payment response');
      }
    }
    catch (err: unknown) {
      if (err instanceof Error) {
      } else {
        console.error('Payment failed. Please try again.');
      }
    } finally {

      setIsLoadingOnline(false);
    }
  };

  if (!isOpen || !mounted) return null;

  if (isLoadingOnline) {
    return (
      <LoadingSpinner />
    )
  }

  return createPortal(
    <>
      <div
        className="fixed inset-0 z-[9999] bg-black bg-opacity-50 animate-fade-in-fast"
        onClick={onClose}
      />

      <div
        ref={modalRef}
        className="h-[90%] overflow-y-auto fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-[10000] bg-[#50514E] rounded-2xl shadow-xl w-[90%] max-w-md overflow-hidden"
      >
        <div className="p-6">
          <div className="flex justify-center mb-6">
            <div className="w-16 h-1 bg-[#FEC400] rounded-full"></div>
          </div>

          {/* Tabs */}
          <div className="flex justify-center mb-6">
            <div className="inline-flex p-1 border border-gray-100 rounded-full">
              <button
                onClick={() => setActiveTab('yearly')}
                className={`px-4 py-2 text-[16px] font-medium rounded-full transition-colors ${activeTab === 'yearly'
                  ? 'bg-[#F4DD94] text-black shadow-sm'
                  : 'text-white hover:text-gray-700'
                  }`}
              >
                Yearly (Save 20%)
              </button>
              <button
                onClick={() => setActiveTab('monthly')}
                className={`px-4 py-2 text-[16px] font-medium rounded-full transition-colors ${activeTab === 'monthly'
                  ? 'bg-[#F4DD94] text-black shadow-sm'
                  : 'text-white hover:text-gray-700'
                  }`}
              >
                Monthly
              </button>
            </div>
          </div>

          <div className='overflow-y-auto flex flex-col justify-start align-center gap-1 border border-gray-200 p-4 rounded-2xl'>

            <div className='flex justify-between gap-8 mb-2'>
              <div
                className='px-1 py-3 rounded-2xl text-black font-bold text-center justify-start w-1/4 items-start'
                style={{
                  background: 'linear-gradient(130deg, #FEC400 -5.74%, rgba(254, 200, 39, 0.96) 3.84%, rgba(254, 204, 59, 0.93) 13.43%, rgba(254, 208, 76, 0.89) 23.01%, rgba(255, 212, 91, 0.85) 32.6%, rgba(255, 216, 105, 0.81) 42.18%, rgba(255, 220, 119, 0.77) 51.77%, rgba(255, 223, 132, 0.73) 61.35%, rgba(255, 227, 145, 0.69) 70.94%, rgba(255, 230, 158, 0.65) 80.52%, rgba(255, 234, 172, 0.62) 90.1%, rgba(255, 237, 185, 0.58) 99.69%, rgba(255, 241, 198, 0.54) 109.27%, rgba(255, 244, 211, 0.50) 118.86%), linear-gradient(130deg, #FEC400 -5.74%, rgba(254, 202, 49, 0.95) 8.1%, rgba(254, 208, 74, 0.89) 21.95%, rgba(255, 213, 96, 0.84) 35.79%, rgba(255, 219, 116, 0.78) 49.64%, rgba(255, 224, 135, 0.72) 63.48%, rgba(255, 229, 154, 0.67) 77.32%, rgba(255, 234, 173, 0.61) 91.17%, rgba(255, 239, 192, 0.56) 105.01%, rgba(255, 244, 211, 0.50) 118.86%), linear-gradient(130deg, #FEC400 -5.74%, rgba(255, 244, 211, 0.50) 118.86%)',
                }}
              >
                Pro +
              </div>

              <div
                onClick={() => router.push('/subscription')}
                className='px-1 py-3 rounded-2xl text-black font-bold w-full text-center'
                style={{
                  background: 'linear-gradient(130deg, #FEC400 -5.74%, rgba(254, 200, 39, 0.96) 3.84%, rgba(254, 204, 59, 0.93) 13.43%, rgba(254, 208, 76, 0.89) 23.01%, rgba(255, 212, 91, 0.85) 32.6%, rgba(255, 216, 105, 0.81) 42.18%, rgba(255, 220, 119, 0.77) 51.77%, rgba(255, 223, 132, 0.73) 61.35%, rgba(255, 227, 145, 0.69) 70.94%, rgba(255, 230, 158, 0.65) 80.52%, rgba(255, 234, 172, 0.62) 90.1%, rgba(255, 237, 185, 0.58) 99.69%, rgba(255, 241, 198, 0.54) 109.27%, rgba(255, 244, 211, 0.50) 118.86%), linear-gradient(130deg, #FEC400 -5.74%, rgba(254, 202, 49, 0.95) 8.1%, rgba(254, 208, 74, 0.89) 21.95%, rgba(255, 213, 96, 0.84) 35.79%, rgba(255, 219, 116, 0.78) 49.64%, rgba(255, 224, 135, 0.72) 63.48%, rgba(255, 229, 154, 0.67) 77.32%, rgba(255, 234, 173, 0.61) 91.17%, rgba(255, 239, 192, 0.56) 105.01%, rgba(255, 244, 211, 0.50) 118.86%), linear-gradient(130deg, #FEC400 -5.74%, rgba(255, 244, 211, 0.50) 118.86%)',
                }}
              >
                Learn More
              </div>
            </div>
            <div className='border-b pb-2 border-gray-100 mb-4'>
              {activeTab === 'yearly' && <span className='text-[12px] mx-2 line-through font-bold'>600.00 EGP</span>}
              <span className='text-[20px] text-[var(--main-color1)] font-bold'>{activeTab === 'yearly' ? '449.00 EGP' : '50.00 EGP'}</span>
              <span className='text-[12px] mx-2 font-bold'>{activeTab === 'yearly' ? 'Yearly' : 'Monthly'}</span>
            </div>

            <ul className="space-y-3 mb-2">
              {features.map((feature, index) => (
                <li key={index} className="flex items-center gap-2">
                  {feature.icon}

                  <span className="text-[14px]">{feature.name}</span>
                </li>
              ))}
            </ul>
            <Link className='ms-2 text-[12px] text-[var(--main-color1)] font-bold'
              href='/subscription'>
              <span className='underline'>Learn More</span>
            </Link>
          </div>

          {/* CTA Button */}
          <button
            className="w-full bg-[var(--main-color1)] hover:bg-yellow-500 text-gray-900 font-semibold py-3 px-4 rounded-lg transition-colors my-4"
            onClick={handlePay}
          >
            Pay Now
          </button>

          <p className="text-center text-xs text-[#BEAF9E]">
            Cancel anytime before the trial ends.
          </p>
        </div>
      </div>
    </>,
    document.body
  );
}
